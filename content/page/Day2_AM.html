---
title: "Day 2 - AM"
output: 
  blogdown::html_page: 
    toc: true
    toc_depth: 2
    highlight: tango
    css: css/camp_style.css
    number_sections: true
    self_contained: false
    fontsize: 18pt
    monofont: Source Code Pro
---

<link href="/rmarkdown-libs/font-awesome/css/all.css" rel="stylesheet" />
<link href="/rmarkdown-libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
  <link rel="stylesheet" href="css\camp_style.css" type="text/css" />

<div id="TOC">
<ul>
<li><a href="#good-morning-young-jedis">Good morning, young Jedis!</a><ul>
<li><a href="#schedule">Schedule</a></li>
</ul></li>
<li><a href="#review-of-day-1">Review of Day 1</a><ul>
<li><a href="#porg-review">Porg review</a></li>
</ul></li>
<li><a href="#join-tables-with-left_join"><span class="toc-section-number">1</span> | Join tables with <code>left_join()</code></a><ul>
<li><a href="#more-joining"><span class="toc-section-number">1.1</span> More joining</a></li>
</ul></li>
<li><a href="#finn-needs-us"><span class="toc-section-number">2</span> | Finn needs us!</a></li>
<li><a href="#the-pipe"><span class="toc-section-number">3</span> | The pipe <code>%&gt;%</code></a></li>
<li><a href="#update-from-bb8"><span class="toc-section-number">4</span> | Update from BB8!</a></li>
<li><a href="#more-jakku-scrap"><span class="toc-section-number">5</span> | More Jakku scrap</a><ul>
<li><a href="#good-news">Good news</a></li>
</ul></li>
<li><a href="#summarize-this"><span class="toc-section-number">6</span> | <code>summarize()</code> this</a><ul>
<li><a href="#sum"><code>sum()</code></a></li>
<li><a href="#mean"><code>mean()</code></a></li>
<li><a href="#median"><code>median()</code></a></li>
<li><a href="#max"><code>max()</code></a></li>
<li><a href="#min"><code>min()</code></a></li>
<li><a href="#nth"><code>nth()</code></a></li>
<li><a href="#sd"><code>sd()</code></a></li>
<li><a href="#quantile"><code>quantile()</code></a></li>
<li><a href="#n"><code>n()</code></a></li>
</ul></li>
<li><a href="#group_by"><span class="toc-section-number">7</span> | <code>group_by()</code></a><ul>
<li><a href="#bargain-hunters">Bargain hunters</a></li>
</ul></li>
<li><a href="#save-files"><span class="toc-section-number">8</span> | Save files</a></li>
<li><a href="#grouped-mutate"><span class="toc-section-number">9</span> | Grouped <code>mutate()</code></a></li>
</ul>
</div>

<div id="good-morning-young-jedis" class="section level1 unnumbered">
<h1>Good morning, young Jedis!</h1>
<hr>
<div class="figure">
<img src="../images/day2_bb8_sq.png" style="float: left; margin-right: 60px; margin-top: -10px;" width="260" />

</div>
<div id="schedule" class="section level2 unnumbered">
<h2>Schedule</h2>
<pre><code>- Review of Day 1
- Summarize your data
- String together many functions
- Join two tables by one or more variables
- Add new column that depends on values of another column
- Summarize by group or category in your data
- Save data</code></pre>
<p><br><br></p>
</div>
</div>
<div id="review-of-day-1" class="section level1 unnumbered">
<h1>Review of Day 1</h1>
<hr>
<div id="porg-review" class="section level2 unnumbered">
<h2>Porg review</h2>
<p>The <em>poggle</em> of porgs has returned to help us review the <code>dplyr</code> functions. Follow along by downloading the <strong>porg</strong> data from the URL below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
porgs &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://itep-r.netlify.com/data/porg_data.csv&quot;</span>)</code></pre></div>
<p><br></p>
<ul class="nav nav-pills" id="myTab" role="tablist" style="margin-top: 18px;">
<li class="nav-item active">
<a class="nav-link" id="porgs-tab" data-toggle="tab" href="#porgs" role="tab" aria-controls="porgs" aria-selected="true"> porgs </a>
</li>
<li class="nav-item">
<a class="nav-link" id="select-tab" data-toggle="tab" href="#select" role="tab" aria-controls="select" aria-selected="false"> <code>select</code> </a>
</li>
<li class="nav-item">
<a class="nav-link" id="arrange-tab" data-toggle="tab" href="#arrange" role="tab" aria-controls="arrange" aria-selected="false"> <code>arrange</code></a>
</li>
<li class="nav-item">
<a class="nav-link" id="filter-tab" data-toggle="tab" href="#filter" role="tab" aria-controls="filter" aria-selected="false"> <code>filter</code></a>
</li>
<li class="nav-item">
<a class="nav-link" id="mutate3-tab" data-toggle="tab" href="#mutate3" role="tab" aria-controls="mutate3" aria-selected="false"> <code>mutate</code></a>
</li>
<li class="nav-item">
<a class="nav-link" id="summarize-tab" data-toggle="tab" href="#summarize" role="tab" aria-controls="summarize" aria-selected="false"> <code>summarize</code></a>
</li>
<li class="nav-item">
<a class="nav-link" id="group_by-tab" data-toggle="tab" href="#group_by" role="tab" aria-controls="group_by" aria-selected="false"> <code>group_by</code></a>
</li>
</ul>
<div id="myTabContent" class="well tab-content" style="background-color: white;">
<div id="porgs" class="tab-pane fade active in" role="tabpanel" aria-labelledby="porgs-tab">
<img src="../images/porgs/porgs_tbl.png" style="width: 85%;" /> <br><br>
</div>
<div id="select" class="tab-pane fade" role="tabpanel" aria-labelledby="select-tab">
<img src="../images/porgs/select.png" style="width: 65%;" /> <img src="../images/porgs/select_tbl.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br> <img src="../images/porgs/select_drop.png" style="width: 65%;" /> <img src="../images/porgs/select_drop_tbl.png" style="width: 80%; margin-left: 5%; margin-top: 12px;" /> <br><br>
</div>
<div id="arrange" class="tab-pane fade" role="tabpanel" aria-labelledby="arrange-tab">
<img src="../images/porgs/arrange.png" style="width: 65%;" /> <img src="../images/porgs/arrange_tbl.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br> <img src="../images/porgs/arrange_desc.png" style="width: 57%;" /> <img src="../images/porgs/arrange_tbl_desc.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br>
</div>
<div id="filter" class="tab-pane fade" role="tabpanel" aria-labelledby="filter-tab">
<img src="../images/porgs/filter.png" style="width: 65%;" /> <img src="../images/porgs/filter_tbl.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br> <img src="../images/porgs/filter2.png" style="width: 75%;" /> <img src="../images/porgs/filter2_tbl.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br>
</div>
<div id="mutate3" class="tab-pane fade" role="tabpanel" aria-labelledby="mutate3-tab">
<img src="../images/porgs/mutate.png" style="width: 77%;" /> <br> <img src="../images/porgs/mutate_tbl.png" style="width: 88%; margin-left: 4%; margin-top: 12px;" /> <br><br>
</div>
<div id="summarize" class="tab-pane fade" role="tabpanel" aria-labelledby="summarize-tab">
<img src="../images/porgs/summarize.png" style="width: 77%;" /> <br> <img src="../images/porgs/summarize_tbl.png" style="width: 88%; margin-left: 4%; margin-top: 12px;" /> <br><br>
</div>
<div id="group_by" class="tab-pane fade" role="tabpanel" aria-labelledby="group_by-tab">
<img src="../images/porgs/groupby.png" style="width: 77%;" /> <br> <img src="../images/porgs/groupby_tbl.png" style="width: 94%; margin-left: 2%; margin-top: 12px;" /> <br><br>
</div>
</div>
<p><br></p>
</div>
</div>
<div id="join-tables-with-left_join" class="section level1">
<h1><span class="header-section-number">1</span> | Join tables with <code>left_join()</code></h1>
<p>Many times concentration data and meteorological data arrive to our desks separately, but we want them joined together.</p>
<div class="figure">
<img src="../images/left_join_venn.png" style="width: 55%;" />

</div>
<br>
<hr>
<div id="how-to-join-2-tables" class="section level3 unnumbered">
<h3>How to join 2 tables</h3>
<p>A general <code>left_join()</code> function looks like the code below.</p>
</div>
<div id="left_jointable1-table2-by-ccolumns-to-join-by" class="section level3 unnumbered">
<h3><code>left_join(table1, table2, by = c(&quot;columns to join by&quot;))</code></h3>
</div>
<div id="adding-porg-names" class="section level3 unnumbered">
<h3>Adding porg names</h3>
<p>Remember our porg friends? How rude of us not to share their names. <strong>Wups!</strong></p>
<p>Here’s a table of their names.</p>
<div style="margin-left: 30px; margin-top: 24px; width: 37%; max-width: 37%; margin-bottom: 22px;">
<div class="figure">
<img src="../images/porgs/porg_names_tbl.png" />

</div>
</div>
<p><strong>Hey now!</strong> That’s not very helpful. Who’s who? Let’s join their names to the rest of the data.</p>
<div class="figure">
<img src="../images/porgs/leftjoin_porgs.png" style="width: 90%; max-width: 85%;" />

</div>
<p><br></p>
</div>
<div id="whats-the-result" class="section level3 unnumbered">
<h3><strong>What’s the result?</strong></h3>
<div class="well">
<div class="figure">
<img src="../images/porgs/porgs_and_names.png" style="width: 85%; max-width: 85%;" />

</div>
</div>
<p><br><br></p>
</div>
<div id="more-joining" class="section level2">
<h2><span class="header-section-number">1.1</span> More joining</h2>
<div id="star-wars-characters" class="section level3 unnumbered">
<h3>Star Wars characters</h3>
<strong>left_join()</strong> is used to add columns to your table by pulling them from another table. Imagine you have the 2 Star Wars tables below. One table includes character names and heights; the second has names and homeworlds. Since both tables share a common name column, we can join the tables together using the name columns as the joining key. <br>
<style type="text/css"> .table {width: 30%;} </style>
<p><br></p>
<div style="float: left;">
<p><code>starwars_heights</code></p>
<table>
<thead>
<tr class="header">
<th align="left">starwars_name</th>
<th align="right">height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Luke Skywalker</td>
<td align="right">172</td>
</tr>
<tr class="even">
<td align="left">C-3PO</td>
<td align="right">167</td>
</tr>
<tr class="odd">
<td align="left">Darth Vader</td>
<td align="right">202</td>
</tr>
<tr class="even">
<td align="left">Leia Organa</td>
<td align="right">150</td>
</tr>
<tr class="odd">
<td align="left">Greedo</td>
<td align="right">246</td>
</tr>
</tbody>
</table>
</div>
<div style="float: left; margin-left: 15%;">
<p><code>starwars_homeworlds</code></p>
<table>
<thead>
<tr class="header">
<th align="left">starwars_name</th>
<th align="left">homeworld</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Luke Skywalker</td>
<td align="left">Tatooine</td>
</tr>
<tr class="even">
<td align="left">C-3PO</td>
<td align="left">Tatooine</td>
</tr>
<tr class="odd">
<td align="left">Darth Vader</td>
<td align="left">Tatooine</td>
</tr>
<tr class="even">
<td align="left">Leia Organa</td>
<td align="left">Alderaan</td>
</tr>
<tr class="odd">
<td align="left">Ayla Secura</td>
<td align="left">Ryloth</td>
</tr>
</tbody>
</table>
</div>
<div style="clear: both;">

</div>
<p><br></p>
<p><strong>Uh oh!</strong> There’s no “Ayla Secura” in the height table and there’s no “Greedo” in the homeworld table. Can we still join the tables? Run the code below to see what happens.</p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
   
<span class="co"># Create new tables </span>
starwars_heights &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">starwars_name =</span> <span class="kw">c</span>(<span class="st">&quot;Luke Skywalker&quot;</span>, <span class="st">&quot;C-3PO&quot;</span>, <span class="st">&quot;Darth Vader&quot;</span>, <span class="st">&quot;Leia Organa&quot;</span>, <span class="st">&quot;Greedo&quot;</span>), 
                               <span class="dt">height =</span> <span class="kw">c</span>(<span class="dv">172</span>, <span class="dv">167</span>, <span class="dv">202</span>, <span class="dv">150</span>, <span class="dv">246</span>))      

starwars_homeworlds &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">starwars_name =</span> <span class="kw">c</span>(<span class="st">&quot;Luke Skywalker&quot;</span>, <span class="st">&quot;C-3PO&quot;</span>, <span class="st">&quot;Darth Vader&quot;</span>, <span class="st">&quot;Leia Organa&quot;</span>, <span class="st">&quot;Ayla Secura&quot;</span>), 
                                  <span class="dt">homeworld =</span> <span class="kw">c</span>(<span class="st">&quot;Tatooine&quot;</span>, <span class="st">&quot;Tatooine&quot;</span>, <span class="st">&quot;Tatooine&quot;</span>, <span class="st">&quot;Alderaan&quot;</span>, <span class="st">&quot;Ryloth&quot;</span>))

<span class="co"># Join the tables together by starwars_name</span>
## Tell left_join which columns to use as the key with:  
##     by = c(&quot;key_left&quot; = &quot;key_right&quot;)
height_and_homeworld &lt;-<span class="st"> </span><span class="kw">left_join</span>(starwars_heights, starwars_homeworlds, 
                                  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;starwars_name&quot;</span> =<span class="st"> &quot;starwars_name&quot;</span>))

height_and_homeworld</code></pre></div>
<p><br></p>
<table>
<thead>
<tr class="header">
<th align="left">starwars_name</th>
<th align="right">height</th>
<th align="left">homeworld</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Luke Skywalker</td>
<td align="right">172</td>
<td align="left">Tatooine</td>
</tr>
<tr class="even">
<td align="left">C-3PO</td>
<td align="right">167</td>
<td align="left">Tatooine</td>
</tr>
<tr class="odd">
<td align="left">Darth Vader</td>
<td align="right">202</td>
<td align="left">Tatooine</td>
</tr>
<tr class="even">
<td align="left">Leia Organa</td>
<td align="right">150</td>
<td align="left">Alderaan</td>
</tr>
<tr class="odd">
<td align="left">Greedo</td>
<td align="right">246</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p><br></p>
<div id="did-it-work" class="section level4 unnumbered">
<h4>Did it work?</h4>
<p>When <strong>left_join</strong> adds the <code>homeworlds</code> column to the <em>starwars_heights</em> table it only adds a value for the characters when the tables have a matching character name. When R couldn’t find “Greedo” in the homeworld table, the Star Wars character’s homeworld was recorded as missing or <em><code>NA</code></em>.</p>
<p><br></p>
</div>
</div>
<div id="multiple-records" class="section level3 unnumbered">
<h3>Multiple records</h3>
<div>
<p><img src="../images/c3po.png" style="width: 13%; float: left; margin-top: 12px; margin-right: 4px;" /> <img src="../images/c3po.png" style="width: 13%; float: left; margin-top: 12px; margin-right: 28px;" /></p>
</div>
<p><br></p>
<p>Now imagine the table <code>starwars_homeworld</code> has two records for C-3PO, each with a different homeworld listed.</p>
<p>What will happen when you join the two tables?</p>
<div style="clear: both;">
<br>
</div>
<div style="float: left;">
<p><code>starwars_heights</code></p>
<table>
<thead>
<tr class="header">
<th align="left">starwars_name</th>
<th align="right">height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Luke Skywalker</td>
<td align="right">172</td>
</tr>
<tr class="even">
<td align="left">C-3PO</td>
<td align="right">167</td>
</tr>
<tr class="odd">
<td align="left">Darth Vader</td>
<td align="right">202</td>
</tr>
<tr class="even">
<td align="left">Leia Organa</td>
<td align="right">150</td>
</tr>
<tr class="odd">
<td align="left">Greedo</td>
<td align="right">246</td>
</tr>
</tbody>
</table>
</div>
<div style="float: left; margin-left: 15%;">
<p><code>starwars_homeworlds</code></p>
<table>
<thead>
<tr class="header">
<th align="left">starwars_name</th>
<th align="left">homeworld</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Luke Skywalker</td>
<td align="left">Tatooine</td>
</tr>
<tr class="even">
<td align="left">C-3PO</td>
<td align="left">Tatooine</td>
</tr>
<tr class="odd">
<td align="left">C-3PO</td>
<td align="left">Tantive IV</td>
</tr>
<tr class="even">
<td align="left">Darth Vader</td>
<td align="left">Tatooine</td>
</tr>
<tr class="odd">
<td align="left">Leia Organa</td>
<td align="left">Alderaan</td>
</tr>
<tr class="even">
<td align="left">Ayla Secura</td>
<td align="left">Ryloth</td>
</tr>
</tbody>
</table>
</div>
<div style="clear: both;">

</div>
<p><br></p>
<p>When you run the code below you’ll see that <strong>left_join</strong> is very thorough and adds each additional homeworld it finds for <em>C-3PO</em> as a new row in the joined table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create new tables </span>
starwars_heights &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">starwars_name =</span> <span class="kw">c</span>(<span class="st">&quot;Luke Skywalker&quot;</span>, <span class="st">&quot;C-3PO&quot;</span>, <span class="st">&quot;Darth Vader&quot;</span>, <span class="st">&quot;Leia Organa&quot;</span>, <span class="st">&quot;Greedo&quot;</span>), 
                               <span class="dt">height  =</span> <span class="kw">c</span>(<span class="dv">172</span>, <span class="dv">167</span>, <span class="dv">202</span>, <span class="dv">150</span>, <span class="dv">173</span>))


starwars_homeworlds &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">starwars_name =</span> <span class="kw">c</span>(<span class="st">&quot;Luke Skywalker&quot;</span>, <span class="st">&quot;C-3PO&quot;</span>, <span class="st">&quot;C-3PO&quot;</span>, <span class="st">&quot;Darth Vader&quot;</span>, <span class="st">&quot;Leia Organa&quot;</span>, <span class="st">&quot;Ayla Secura&quot;</span>), 
                                  <span class="dt">homeworld =</span> <span class="kw">c</span>(<span class="st">&quot;Tatooine&quot;</span>, <span class="st">&quot;Tatooine&quot;</span>, <span class="st">&quot;Tantive IV&quot;</span>, <span class="st">&quot;Tatooine&quot;</span>, <span class="st">&quot;Alderaan&quot;</span>, <span class="st">&quot;Ryloth&quot;</span>))

<span class="co"># Join the tables together by Star Wars character name</span>
height_and_homeworld &lt;-<span class="st"> </span><span class="kw">left_join</span>(starwars_heights, starwars_homeworlds)

<span class="co"># Check number of rows</span>
<span class="kw">nrow</span>(height_and_homeworld)

height_and_homeworld</code></pre></div>
<p><br></p>
<table>
<thead>
<tr class="header">
<th align="left">starwars_name</th>
<th align="right">height</th>
<th align="left">homeworld</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Luke Skywalker</td>
<td align="right">172</td>
<td align="left">Tatooine</td>
</tr>
<tr class="even">
<td align="left">C-3PO</td>
<td align="right">167</td>
<td align="left">Tatooine</td>
</tr>
<tr class="odd">
<td align="left">C-3PO</td>
<td align="right">167</td>
<td align="left">Tantive IV</td>
</tr>
<tr class="even">
<td align="left">Darth Vader</td>
<td align="right">202</td>
<td align="left">Tatooine</td>
</tr>
<tr class="odd">
<td align="left">Leia Organa</td>
<td align="right">150</td>
<td align="left">Alderaan</td>
</tr>
<tr class="even">
<td align="left">Greedo</td>
<td align="right">173</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="note">
<p>This results in a table with one extra row than we started with in our heights table. So growing table sizes are a sign of duplicate records when using <strong>left_join()</strong>.</p>
<p>In practice, when you see this you’ll want to investigate why one of your tables has duplicate entries, especially if the observation for the two rows is different, as it was for <em>C-3PO’s</em> homeword.</p>
<p>Are there really two different Star Wars characters named <em>C-3PO</em>, or maybe someone made two different guesses about the droid’s homeworld, or maybe the data simply has a mistake.</p>
</div>
<p><br></p>
</div>
</div>
</div>
<div id="finn-needs-us" class="section level1">
<h1><span class="header-section-number">2</span> | Finn needs us!</h1>
<p>That’s enough <em>scuttlebutting</em> around on Endor, Finn needs us back on Jakku. It turns out we forgot to pick-up Finn when we left. Now he’s being held ransom by Junk Boss Plutt. We’ll need to act fast to get to him before the Empire does. <strong>Blast off!</strong></p>
<div class="figure">
<img src="../images/finn_run.gif" />

</div>
<p><br></p>
<div class="note">
<p>Did you get tired of writing <code>scrap</code> so many times yesterday? Let’s learn to chain several functions together. I mean I have now written <code>scrap</code> like a million times and my fingers hurt. Mother of moons!</p>
</div>
</div>
<div id="the-pipe" class="section level1">
<h1><span class="header-section-number">3</span> | The pipe <code>%&gt;%</code></h1>
<p><strong>Let the <code>%&gt;%</code> guide you young Padawan.</strong></p>
<div class="figure">
<img src="https://d21ii91i3y6o6h.cloudfront.net/gallery_images/from_proof/9302/medium/1447173978/rstudio-hex-pipe-dot-psd.png" align="left" style="margin-right: 28px; margin-bottom: 22px;" width="155" />

</div>
<p><br></p>
<p>Luckily, you <strong>don’t</strong> have to do ALL that typing. The pipe let’s you chain functions together and do everything in one go.</p>
<p><br></p>
<div style="clear:both;">

</div>
</div>
<div id="update-from-bb8" class="section level1">
<h1><span class="header-section-number">4</span> | Update from BB8!</h1>
<hr>
<div class="figure">
<img src="../images/rey_bb8.jpg" align="right" style="width: 35%; margin-top: 0px; margin-left: 15px; margin-right: 0px;" />

</div>
<p>BB8 was able to recover the <strong>full</strong> scrap data from the notorious Junk Boss Unkar Plutt. We will experiment with pipe using the <code>starwars_scrap_jakku_full.csv</code> dataset.</p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)

<span class="co"># Read in the larger scrap database</span>
<span class="co"># Note: The data set has items that are in units other than tons. </span>
scrap &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://itep-r.netlify.com/data/starwars_scrap_jakku_full.csv&quot;</span>)


ion_scrap &lt;-<span class="st"> </span>scrap <span class="op">%&gt;%</span>
<span class="st">             </span><span class="kw">filter</span>(item <span class="op">==</span><span class="st"> &quot;Ion engine&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">             </span><span class="kw">arrange</span>(<span class="kw">desc</span>(amount))</code></pre></div>
<p><br></p>
</div>
<div id="more-jakku-scrap" class="section level1">
<h1><span class="header-section-number">5</span> | More Jakku scrap</h1>
<p>Plutt is demanding <strong>10,000 items</strong> of scrap for Finn. Lucky for us he didn’t clarify the exact items. Let’s find the scrap that weighs the least per item to make this transaction as easy as possible.</p>
<div id="good-news" class="section level2 unnumbered">
<h2>Good news</h2>
<p>BB8 tracked down a scrap <code>Mass conversion table</code> from his old droid buddies. Our current table shows the total cubic yards for some scrap shipments, but not how much the shipment weighs. If we join our scrap data to the conversion table then we can really start digging into what would be the lightest item for trade. And we can do that much more efficiently now that we know <code>left_join()</code>!</p>
<div id="get-the-pounds-conversion-table" class="section level3 unnumbered">
<h3>Get the pounds conversion table</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)

<span class="co"># The data&#39;s url</span>
convert_url &lt;-<span class="st"> &quot;https://itep-r.netlify.com/data/conversion_table.csv&quot;</span>

<span class="co"># Read in the conversion data</span>
convert &lt;-<span class="st"> </span><span class="kw">read_csv</span>(convert_url)

<span class="kw">head</span>(convert, <span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   item               units       pounds
##   &lt;chr&gt;              &lt;chr&gt;        &lt;dbl&gt;
## 1 Bulkhead           Cubic Yards    321
## 2 Hull Panel         Cubic Yards    641
## 3 Repulsorlift array Cubic Yards    467</code></pre>
<p><br></p>
</div>
<div id="re-read-the-full-scrap-data" class="section level3 unnumbered">
<h3>Re-read the full scrap data</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)

<span class="co"># Read in the larger scrap database</span>
<span class="co"># Note: The data set has items that are in units other than tons. </span>
scrap &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://itep-r.netlify.com/data/starwars_scrap_jakku_full.csv&quot;</span>)

<span class="co"># Run either of the following to see </span>
<span class="co"># what -unit- types are in the data </span>
<span class="kw">unique</span>(scrap<span class="op">$</span>units)</code></pre></div>
<pre><code>## [1] &quot;Cubic Yards&quot; &quot;Items&quot;       &quot;Tons&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">distinct</span>(scrap, units)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##   units      
##   &lt;chr&gt;      
## 1 Cubic Yards
## 2 Items      
## 3 Tons</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Join the scrap to the conversion table</span>
scrap &lt;-<span class="st"> </span><span class="kw">left_join</span>(scrap, convert, 
                   <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;item&quot;</span> =<span class="st"> &quot;item&quot;</span>, <span class="st">&quot;units&quot;</span> =<span class="st"> &quot;units&quot;</span>))</code></pre></div>
<p><br></p>
<blockquote>
<p>Want to skimp on typing?</p>
</blockquote>
<p>When the 2 tables share column names that are the same, <code>left_join()</code> will automatically search for matching columns if you don’t use the <code>by=</code> argument. So the code below does the same as above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap &lt;-<span class="st"> </span><span class="kw">left_join</span>(scrap, convert)

<span class="kw">head</span>(scrap, <span class="dv">4</span>)</code></pre></div>
<pre><code>## # A tibble: 4 x 8
##   receipt_date item  origin destination amount units price_per_pound pounds
##   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
## 1 4/1/2013     Bulk~ Crate~ Raiders       4017 Cubi~           1005.    321
## 2 4/2/2013     Star~ Outsk~ Trade cara~   1249 Cubi~           1129.    637
## 3 4/3/2013     Star~ Outsk~ Niima Outp~   4434 Cubi~           1129.    637
## 4 4/4/2013     Hull~ Crate~ Raiders        286 Cubi~            843.    641</code></pre>
<p><br></p>
<p><strong>Help!</strong> You can type <code>?left_join</code> to see all the arguments and options.</p>
<p><br></p>
<div id="exercise" class="section level4 unnumbered">
<h4><i class="fa fa-cogs" aria-hidden="true" style="color: green"></i> Exercise</h4>
<ul class="nav nav-pills" id="myTab" role="tablist" style="margin-top: 18px;">
<li class="nav-item active">
<a class="nav-link" id="totalcredits-tab" data-toggle="tab" href="#totalcredits" role="tab" aria-controls="totalcredits" aria-selected="true">Total credits</a>
</li>
<li class="nav-item">
<a class="nav-link" id="showhint-tab" data-toggle="tab" href="#showhint" role="tab" aria-controls="showhint" aria-selected="false">Show hint</a>
</li>
<li class="nav-item">
<a class="nav-link" id="showcode-tab" data-toggle="tab" href="#showcode" role="tab" aria-controls="showcode" aria-selected="false">Show code</a>
</li>
</ul>
<div id="myTabContent" class="well tab-content" style="background-color: white;">
<div id="totalcredits" class="tab-pane fade active in" role="tabpanel" aria-labelledby="totalcredits-tab">
<h4>
Total credits
</h4>
<p>We now have the amount sold, the weight of that amount in pounds, and the price in credits per pound. Let’s use these 3 pieces of information to find the total amount of credits for each transaction. How do we calculate that?</p>
<pre class="sourceCode r">

# Calculate the total credits for each transaction
scrap <- scrap %>% 
         mutate(_______ = _______________)
         
</pre>
</div>
<div id="showhint" class="tab-pane fade" role="tabpanel" aria-labelledby="showhint-tab">
<h4>
Total credits
</h4>
<p>We need to do some serious multiplication. We now have the amount sold, the conversion to pounds, and the credits per pound, but we want to know the total amount of credits for each transaction. How would we calculate that?</p>
<pre class="sourceCode r">

# Calculate the total credits for each transaction
scrap <- scrap %>% 
         mutate(credits = _______ * _______ * ________)

</pre>
</div>
<div id="showcode" class="tab-pane fade" role="tabpanel" aria-labelledby="showcode-tab">
<h4>
Total credits
</h4>
<p>We need to do some serious multiplication. We now have the amount sold, the conversion to pounds, and the credits per pound, but we want to know the total amount of credits for each transaction. How would we calculate that?</p>
<pre class="sourceCode r">

# Calculate the total credits for each transaction
scrap <- scrap %>% 
         mutate(credits = amount * pounds * price_per_pound)
         
</pre>
</div>
</div>
<p><br></p>
<div class="note">
<p>Data analysts often get asked questions similar to:</p>
<ul>
<li>What’s the highest number?</li>
<li>What’s the lowest number?</li>
<li>So what’s the average tonnage of scrap from Cratertown this year?</li>
<li>Who’s making the most money this year?</li>
</ul>
<h4 id="so-let-us-move-on-to-summarize." class="unnumbered">So let us move on to <code>summarize()</code>.</h4>
</div>
</div>
</div>
</div>
</div>
<div id="summarize-this" class="section level1">
<h1><span class="header-section-number">6</span> | <code>summarize()</code> this</h1>
<hr>
<div class="figure">
<img src="../images/summarize_diagram.png" width="490" />

</div>
<p><code>summarize()</code> allows you to apply a summary function like <code>median()</code> to a column and collapse your data down to a single row. To really dig into <code>summarize</code> you’ll want to know some common summary functions, such as <code>sum()</code>, <code>mean()</code>, <code>median()</code>, <code>min()</code>, and <code>max()</code>.</p>
<div id="sum" class="section level2 unnumbered">
<h2><code>sum()</code></h2>
<p>Use <code>summarize()</code> and <code>sum()</code> to find the total credits from all the scrap.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, <span class="dt">total_credits =</span> <span class="kw">sum</span>(credits))</code></pre></div>
</div>
<div id="mean" class="section level2 unnumbered">
<h2><code>mean()</code></h2>
<p>Use <code>summarize()</code> and <code>mean()</code> to calculate the <em>mean</em> <code>price_per_pound</code> in the scrap report.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, <span class="dt">mean_price =</span> <span class="kw">mean</span>(price_per_pound, <span class="dt">na.rm =</span> T))</code></pre></div>
<p><br></p>
<blockquote>
<p>Note the <code>na.rm = TRUE</code> in the <code>mean()</code> function. This tells R to ignore empty cells or missing values that show up in R as <code>NA</code>. If you leave <code>na.rm</code> out, the <em>mean</em> function will return ‘NA’ if it finds a missing value in the data.</p>
</blockquote>
</div>
<div id="median" class="section level2 unnumbered">
<h2><code>median()</code></h2>
<p>Use summarize to calculate the <em>median</em> price_per_pound in the scrap report.</p>
<p><code>summarize(scrap, median_price = median(price_per_pound, na.rm = T))</code></p>
</div>
<div id="max" class="section level2 unnumbered">
<h2><code>max()</code></h2>
<p>Use summarize to calculate the <em>maximum</em> price per pound any scrapper got for their scrap.</p>
<p><code>summarize(scrap, max_price = max(price_per_pound, na.rm = T))</code></p>
</div>
<div id="min" class="section level2 unnumbered">
<h2><code>min()</code></h2>
<p>Use summarize to calculate the <em>minimum</em> price per pound any scrapper got for their scrap.</p>
<p><code>summarize(scrap, min_price = min(price_per_pound, na.rm = T))</code></p>
</div>
<div id="nth" class="section level2 unnumbered">
<h2><code>nth()</code></h2>
<p>Use <code>summarize()</code> and <code>nth(Origin, 12)</code> to find the name of the Origin City that got the <em>12th</em> highest scrapper haul.</p>
<p><em>Hint: Use <code>arrange()</code> first.</em></p>
<p><code>arrange(scrap, desc(credits)) %&gt;% summarize(price_12 = nth(origin, 12))</code></p>
</div>
<div id="sd" class="section level2 unnumbered">
<h2><code>sd()</code></h2>
<p>What is the <em>standard deviation</em> of the credits?</p>
<p><code>summarize(scrap, stdev_credits = sd(credits))</code></p>
</div>
<div id="quantile" class="section level2 unnumbered">
<h2><code>quantile()</code></h2>
<p><em>Quantiles</em> are useful for finding the upper or lower range of a column. Use the <code>quantile()</code> function to find the the 5th and 95th quantile of the prices.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, 
          <span class="dt">price_5th_pctile  =</span> <span class="kw">quantile</span>(price_per_pound, <span class="fl">0.05</span>, <span class="dt">na.rm =</span> T),
          <span class="dt">price_95th_pctile =</span> <span class="kw">quantile</span>(price_per_pound, <span class="fl">0.95</span>))</code></pre></div>
<p><strong>Hint:</strong> Add <code>na.rm = T</code> to <code>quantile()</code>.</p>
</div>
<div id="n" class="section level2 unnumbered">
<h2><code>n()</code></h2>
<p><code>n()</code> stands for <em>count</em>.</p>
<p>Use summarize and <code>n()</code> to count the number of reported scrap records going to <code>Niima outpost</code>.</p>
<p><strong>Hint:</strong> Use <code>filter()</code> first.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">niima_scrap &lt;-<span class="st"> </span><span class="kw">filter</span>(scrap, destination <span class="op">==</span><span class="st"> &quot;Niima Outpost&quot;</span>) 

niima_scrap &lt;-<span class="st"> </span><span class="kw">summarize</span>(niima_scrap, <span class="dt">scrap_records =</span> <span class="kw">n</span>())</code></pre></div>
<p><br></p>
<div id="exercise-1" class="section level3 unnumbered">
<h3><i class="fa fa-cogs" aria-hidden="true" style="color: green"></i> Exercise</h3>
<p>Create a summary of the scrap data that includes 3 of the summary functions above. The following is one example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary &lt;-<span class="st"> </span><span class="kw">summarize</span>(scrap, 
                     <span class="dt">max_credits      =</span> __________,
                     <span class="dt">weight_90th_pct  =</span> <span class="kw">quantile</span>(Weight, <span class="fl">0.90</span>),
                     <span class="dt">count_records    =</span> __________,</code></pre></div>
<p><br></p>
<div class="note">
<h4 id="shut-me-down" class="unnumbered"><strong>Shut me down!</strong></h4>
<p>That was a whole lot of summarizing. Do we really have to filter to the Origin City that we’re interested in every time?</p>
<p>It sure would be nice if we could easily find the mean price for every Origin City. Then we could summarize once and be done with it.</p>
<h4 id="its-time-for-group_by" class="unnumbered">It’s time for <code>group_by()</code>!</h4>
</div>
</div>
</div>
</div>
<div id="group_by" class="section level1">
<h1><span class="header-section-number">7</span> | <code>group_by()</code></h1>
<hr>
<div id="bargain-hunters" class="section level2 unnumbered">
<h2>Bargain hunters</h2>
<p>Who’s selling goods for cheap? Use <code>group_by</code> with the column <em>Origin</em>, and then use<code>summarize</code> to find the <code>mean(price_per_pound)</code> at each Origin City.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap_summary &lt;-<span class="st"> </span><span class="kw">group_by</span>(scrap, origin) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                 </span><span class="kw">summarize</span>(<span class="dt">mean_price =</span>  <span class="kw">mean</span>(price_per_pound, <span class="dt">na.rm =</span> T)) </code></pre></div>
<p><br></p>
<p><details> <summary class="btn_code_blue"> Rounding digits </summary></p>
<div class="note">
<p>
<p>You can round the prices to a certain number of digits using the <code>round()</code> function. We can finish by adding the <code>arrange()</code> function to sort the table by our new column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap_means &lt;-<span class="st"> </span><span class="kw">group_by</span>(scrap, origin) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                 </span><span class="kw">summarize</span>(<span class="dt">mean_price       =</span>  <span class="kw">mean</span>(price_per_pound, <span class="dt">na.rm =</span> T),
                           <span class="dt">mean_price_round =</span> <span class="kw">round</span>(mean_price, <span class="dt">digits =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">                 </span><span class="kw">arrange</span>(mean_price_round) <span class="op">%&gt;%</span>
<span class="st">                 </span><span class="kw">ungroup</span>()</code></pre></div>
<p><br></p>
<p><strong>NOTE:</strong></p>
<p>The <code>round()</code> function in R does not automatically round values ending in 5 up. Instead it uses scientific rounding, which rounds values ending in 5 to the nearest even number. So 2.5 rounded to the nearest whole number rounds down to 2, and 3.5 rounded to the nearest whole number rounds up 4.</p>
</p>
</div>
<p></details></p>
<p><br></p>
<p>Who’s making lots of transactions? Try using <code>group_by</code> with the column <em>origin</em> and then <code>summarize</code> to count the number of scrap records at each city.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap_counts &lt;-<span class="st"> </span><span class="kw">group_by</span>(scrap, origin) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                </span><span class="kw">summarize</span>(<span class="dt">origin_count  =</span>  <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                </span><span class="kw">ungroup</span>()</code></pre></div>
<p><br></p>
<div id="pro-tip" class="section level3 unnumbered">
<h3><i class="fa fa-user-astronaut" aria-hidden="true" style="color:#040707;"></i> Pro-tip!</h3>
<div class="well">
<p>Ending with <code>ungroup()</code> is good practice. This prevents your data from staying grouped after the summarizing has been completed.</p>
</div>
</div>
</div>
</div>
<div id="save-files" class="section level1">
<h1><span class="header-section-number">8</span> | Save files</h1>
<hr>
<p>Let’s save the mean price summary table we created to a <em>CSV</em>. That way we can transfer it to a <em>droid courier</em> for delivery to Rey. To save a data frame we can use the <code>write_csv()</code> function from our favorite <code>readr</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Write the file to your results folder</span>
<span class="kw">write_csv</span>(scrap_summary, <span class="st">&quot;results/prices_by_origin.csv&quot;</span>)</code></pre></div>
<p><br></p>
<div id="warning" class="section level3 unnumbered">
<h3><i class="fa fa-user-astronaut" aria-hidden="true" style="color:#040707;"></i> <strong>Warning!</strong></h3>
<div class="well">
<p>By default, when saving R will overwrite a file if the file already exists in the same folder. It will not ask for confirmation. To be safe, save processed data to a new folder called <code>results/</code> and not to your raw <code>data/</code> folder.</p>
</div>
</div>
</div>
<div id="grouped-mutate" class="section level1">
<h1><span class="header-section-number">9</span> | Grouped <code>mutate()</code></h1>
<br>
<hr>
<p>We can bring back <code>mutate</code> to add a column based on the grouped values in a data set. For example, you may want to add a column showing the mean price by origin to the whole table, but still keep all of the records. This is a good way to add values to the table to serve as a reference point.</p>
<blockquote>
<p>How does the price of Item X compare to the average price?</p>
</blockquote>
<p>When you combine <code>group_by</code> and <code>mutate</code> the new column will be calculated based on the values within each group. Let’s group by <code>origin</code> to find the <code>mean()</code> price per pound at each origin.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap &lt;-<span class="st"> </span><span class="kw">group_by</span>(scrap, origin) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">            </span><span class="kw">mutate</span>(<span class="dt">origin_mean_price =</span> <span class="kw">mean</span>(price_per_pound, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">            </span><span class="kw">ungroup</span>()</code></pre></div>
<p><br></p>
<div id="return-to-homebase" class="section level3 unnumbered">
<h3><i class="fa fa-rocket" aria-hidden="true"></i> Return to <a href="../post/day-2.html">Homebase</a></h3>
<p><br></p>
</div>
</div>
